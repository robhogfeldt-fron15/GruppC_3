function setUserStatus(e){currentStatus=e,myUserRef.set({name:dbRef.getAuth().password.email,status:e})}function LoginFunction(){dbRef.authWithPassword({email:$("#email").val(),password:$("#pwd").val()},function(e,n){e?($("#error").text(e),console.log("Login Failed!",e)):(console.log("Login Success!:",n),window.location.href="profile.html")})}function getNote(e){var n=dbRef.getAuth(),t="https://shining-fire-7520.firebaseio.com/users/"+n.uid+"/lessons/"+e,s=new Firebase(t);s.once("value",function(e){var n=e.val(),t=n.notes;t?($("#note").text(t.note.content),console.log(t.note.content)):$("#note").text("")})}function getSynchronizedArray(e){var n=[];return syncChanges(n,e),n}function syncChanges(e,n){n.on("child_added",function(n,t){var s=n.val();s.$id=n.key();var o=positionAfter(e,t);e.splice(o,0,s)})}function positionFor(e,n){for(var t=0,s=e.length;s>t;t++)if(e[t].$id===n)return t;return-1}function positionAfter(e,n){if(null===n)return 0;var t=positionFor(e,n);return-1===t?e.length:t+1}function setChoosen(e){var n=dbRef.getAuth(),t="https://shining-fire-7520.firebaseio.com/users/"+n.uid+"/lessons/"+e,s=new Firebase(t);s.once("value",function(e){console.log(e.val()),$("#choosenTitle").empty(),$("#choosenNote").empty();var n=e.val();$("#choosenTitle").text("Vald föreläsning: "+n.lesson.name),n.notes&&$("#choosenNote").text(n.notes.note)})}var rootUrl="https://shining-fire-7520.firebaseio.com/",dbRef=new Firebase("https://shining-fire-7520.firebaseio.com/"),emailField=$("#email"),pwdField=$("#pwd"),name="name",currentStatus="★ online",userListRef=new Firebase("https://shining-fire-7520.firebaseio.com/presence"),myUserRef=userListRef.push(),connectedRef=new Firebase("https://shining-fire-7520.firebaseio.com/.info/connected");connectedRef.on("value",function(e){e.val()?(myUserRef.onDisconnect().remove(),setUserStatus("★ online")):setUserStatus("★ offline")}),userListRef.on("child_added",function(e){var n=e.val();$("#presenceDiv").append($("<div/>").attr("id",e.name())),$("#"+e.name()).text(n.name+" is currently "+n.status)}),userListRef.on("child_removed",function(e){$("#"+e.name()).remove()}),userListRef.on("child_changed",function(e){var n=e.val();$("#"+e.name()).text(n.name+" is currently "+n.status)}),$("#regUser").on("click",function(){dbRef.createUser({email:$("#email").val(),password:$("#pwd").val()},function(e,n){if(e)$("#error").text(e),console.log("Error creating user:",e);else{console.log("Successfully created user account with uid:",n.uid);var t={email:$("#email").val()};this.saveUser(n.uid,t)}})});var saveUser=function(e,n){dbRef.child("users").child(e).set(n)};$("#loginUser").on("click",function(){LoginFunction()}),$(".form-control").keypress(function(e){13==e.keyCode&&LoginFunction()});var loadCurrentUser=function(){var e=dbRef.getAuth();if(e){var n=rootUrl+"users/"+e.uid,t=new Firebase(n),s="https://shining-fire-7520.firebaseio.com/users/"+e.uid+"/lessons/",o=new Firebase(s);t.once("value",function(e){var n=e.val();console.log(n.email),$("#welcome").text("welcome "+n.email)}),$("#lesson-list").empty(),o.on("child_added",function(e){var n=e.val(),t=$("<li>").attr("class","list-group-item").append($("<p>").attr({"class":"lesson",id:e.key()}).text(n.lesson.name).append()).append($("<span>").attr({"class":"lessonDate"}).text(n.lesson.date));$("#lesson-list").append(t)})}};$(document).on("click",".lesson",function(){$(".choosenLessonStyle").removeClass("choosenLessonStyle"),$(this.parentElement).addClass("choosenLessonStyle"),setChoosen(this.id)});var createLesson=function(){var e=dbRef.getAuth(),n=new Firebase("https://shining-fire-7520.firebaseio.com/users/"+e.uid),t=n.child("lessons");t.push({lesson:{name:$("#lesson").val(),date:$("#date").val()}}),loadCurrentUser()},saveLesson=function(e,n){dbRef.child("users").child(e).set(userData)},saveNote=function(){var e=$("#choosenId").text(),n=dbRef.getAuth(),t=new Firebase("https://shining-fire-7520.firebaseio.com/users/"+n.uid+"/lessons/"+e),s=t.child("notes");s.set({note:{content:$("#note").val()}})};$(".rtBtn").click(function(){var e=$(this),n=e.attr("name");dbRef.child("status").set({style:n},function(e){null!==e&&alert("Unable to push comments to Firebase!")})});var statusRef=dbRef.child("status");statusRef.on("child_changed",function(e){var n=e.val();highLight(n)});var highLight=function(e){$("#highLightParent").children().each(function(){var n=$(this).attr("id");n===e&&($("#"+n).addClass("highlighted"),window.setTimeout(function(){$("#"+n).removeClass("highlighted")},3e3))})},chatRef=dbRef.child("chat");$("#submit-btn").bind("click",function(){var e=$("#comments"),n=$.trim(e.val());if(console.log(n.length),n.length<1)alert("Kommentar måste vara längre");else{var t=dbRef.getAuth();chatRef.push({comment:{user:t.password.email,content:n}},function(e){null!==e&&alert("Error")}),e.val("")}return!1}),chatRef.on("child_added",function(e){var n=e.val().comment,t=$("#comments-container");$("<div/>",{"class":"comment-container"}).html('<span class="label label-default">'+n.user+"</span>"+n.content).appendTo(t),t.scrollTop(t.prop("scrollHeight"))}),$("#reset-btn").bind("click",function(){chatRef.remove()});var createLesson=function(){var e=dbRef.getAuth(),n=new Firebase("https://shining-fire-7520.firebaseio.com/users/"+e.uid),t=n.child("lessons");t.push({lesson:{name:$("#lessonTitle").val(),date:$("#lessonDate").val()}}),loadCurrentUser()},createNote=function(){var e=$(".choosenLessonStyle").find("p").attr("id");console.log(e);var n=dbRef.getAuth(),t=new Firebase("https://shining-fire-7520.firebaseio.com/users/"+n.uid+"/lessons/"+e),s=t.child("notes");s.set({note:$("#choosenNote").val()})};